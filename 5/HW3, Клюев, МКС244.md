## Задание

![[Pasted image 20250426175220.png]]
[Линк](https://www.architecturalkatas.com/kata.html?kata=TakingRequests.json)

## ФТ и НФТ (ДЗ1)
[Линк](https://github.com/nikolaysavelev/system-design-hse-miem-2025/pull/8)
## Архитектура и сервисы (ДЗ2)
[Линк](https://github.com/nikolaysavelev/system-design-hse-miem-2025/pull/8)
## Выполнение

Проработаем:
1. Логику БД под микросервисы с учетом реальных сценариев использования системы
2. Способы репликации и шардирования данных с учетом особенностей микросервисов

### Общие соображения
Система, разрабатываемая для радиостанции, не предполагает высокой нагрузки на уровне десятков тысяч пользователей одновременно. Ожидаемая пиковая нагрузка составляет около 2000 пользователей, что позволяет использовать более простые архитектурные решения и не требует сложных механизмов масштабирования на начальном этапе.
### Выбор технологий работы с БД под микросервисы

| Микросервис                    | База данных     | Обоснование                                                                                                                 |
| ------------------------------ | --------------- | --------------------------------------------------------------------------------------------------------------------------- |
| Auth Service                   | PostgreSQL, БД1 | Необходима реляционная база для хранения пользователей и их аутентификационных данных. Поддержка транзакций и безопасности. |
| User Service                   | PostgreSQL, БД1 | Хранение профилей пользователей требует реляционной структуры для управления данными и ролями.                              |
| Music Catalog Service          | PostgreSQL, БД2 | Необходима возможность сложного поиска и индексации песен и исполнителей. PostgreSQL поддерживает полнотекстовый поиск.     |
| Requests & Voting Service      | PostgreSQL, БД2 | Обработка заявок и голосов требует надежной базы данных с поддержкой транзакций и целостности данных.                       |
| Playlists Service              | PostgreSQL, БД2 | Управление плейлистами требует реляционной структуры для хранения информации о песнях и их ранжировании.                    |
| DJ/Admin Interface Service     | PostgreSQL, БД1 | Необходима реляционная база для управления доступом и интерфейсом для сотрудников.                                          |
| Integration Service            | PostgreSQL, БД2 | Хранение информации о текущих песнях и интеграция с эфирным софтом.                                                         |
| Notification Service           | Redis, БД3      | Redis подходит для хранения временных данных и кэширования уведомлений, что обеспечивает быструю отправку.                  |
| Real-time Notification Service | Redis, БД3      | Использование Redis для хранения активных соединений и отправки обновлений в реальном времени.                              |
Работаем с двумя БД на PostreSQL и одной БД на Redis, потому что:
- Малая нагрузка на приложение, допустимо обращение к одной и той же БД несколькими микросервисами
- Требования к быстрому пилоту для проверки гипотезы -> снижение времени на разработку
- БД разнесены по логике: микросервисы с музыкой работают с первой БД, пользовательский интерфейс и сопряженные микросервисы – вторую.
В случае успешного подтверждения гипотезы можем разнести микросервисы по отдельным БД.
### Репликация и шардирование
#### Репликация
- PostgreSQL (для Auth Service, User Service, Music Catalog Service, Requests & Voting Service, Playlists Service, DJ/Admin Interface Service, Integration Service):
	  - Синхронная репликация: Используется для обеспечения целостности данных и минимизации потерь в случае сбоя. Это критично для сервисов, обрабатывающих чувствительные данные (Auth Service, User Service).
	  - Асинхронная репликация: Применяется для остальных сервисов, где время отклика менее критично, что позволяет улучшить производительность.
- Redis (для Notification Service и Real-time Notification Service):
	  - Асинхронная репликация: Используется для кэширования уведомлений и активных соединений, что позволяет быстро отправлять данные без задержек.
#### Шардинг
- PostgreSQL:
	  - Шардинг по пользователям: Применяется для User Service и Auth Service, где данные пользователей могут быть распределены по разным серверам на основе уникального идентификатора.
	  - Шардинг по типам данных Используется в Requests & Voting Service и Playlists Service, где данные могут быть разделены на заявки, голоса и плейлисты, что позволяет оптимизировать производительность.
- Redis:
	  - Динамический шардинг: Применяется для Notification Service и Real-time Notification Service, где данные могут быть распределены по серверам на основе текущей нагрузки и объема данных.

### Обновленная схема HLD с учетом БД
![[Pasted image 20250620200032.png]]
